---
title: "Extinctions Unit"
author: "Caroline Wichterman, Megna Reddy"
maketitle: true
output: github_document
---



```{r include=FALSE}
library("tidyverse")
library("httr")
library("jsonlite")
library("glue")
#library("printr")
knitr::opts_chunk$set(comment=NA)
```

```{r}
base <- "https://apiv3.iucnredlist.org/api/v3"
endpoint <- "speciescount"
token <- "9bb4facb6d23f48efbf424bb05c0c1ef1cf6f468393bc745d42179ac4aca5fee"
url <- glue("{base}/{endpoint}?token={token}")

req <- GET(url)
x <- content(req)
x$speciescount
```

```{r}
species_endpoint <- "species"
page <- paste0("page/", 0:15)
all_pages <- glue("{base}/{species_endpoint}/{page}?token={token}")
```

```{r}
if(!file.exists("all_species.rds"))
  all_species <- map(all_pages, GET)
  write_rds(all_species,, "all_species.rds")
}
```

```{r}
all_species <- read_rds("all_species.rds")
```

```{r}
codes ,- map_int(all_species, status_code)
stop_if_not(all(codes < 400))
```

```{r}
all_resp <- map(all_species, content, encoding = "UTF-8")
```

```{r}
sci_name <-
  map(all_resp, \(page) map_chr(page$result, "scientific_name"))

x <- unlist(sci_name)
length(sci_name[[4]])
```

```{r}
```

```{r}
sci_name <-  map_chr(page0_resp$result, "scientific_name")
category <- map_chr(page0_resp$result, "category")

all_species <- tibble(sci_name, category)



```

```{r}
extinct_species <- all_species |> filter(category == %in% c("CR", "EX"))
```




## Extinctions Module

_Are we experiencing the sixth great extinction?_  

What is the current pace of extinction? Is it accelerating? How does it compare to background extinction rates?

## Background

- [Section Intro Video](https://youtu.be/QsH6ytm89GI)
- [Ceballos et al (2015)](http://doi.org/10.1126/sciadv.1400253)

Our focal task will be to reproduce the result from Ceballos and colleagues showing the recent increase in extinction rates relative to the background rate:

![](https://espm-157.carlboettiger.info/img/extinctions.jpg)


## Computational Topics

- Accessing data from a RESTful API
- Error handling
- JSON data format
- Regular expressions
- Working with missing values

## Additional references:

- http://www.hhmi.org/biointeractive/biodiversity-age-humans (Video)
- [Barnosky et al. (2011)](http://doi.org/10.1038/nature09678)
- [Pimm et al (2014)](http://doi.org/10.1126/science.1246752)
- [Sandom et al (2014)](http://dx.doi.org/10.1098/rspb.2013.3254)




